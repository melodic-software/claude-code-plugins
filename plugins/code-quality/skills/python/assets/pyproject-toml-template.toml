# Modern Python Project Configuration Template
# pyproject.toml - PEP 517/518/621 compliant
# Last Updated: 2025-11-17
# See: https://packaging.python.org/en/latest/guides/writing-pyproject-toml/

# =============================================================================
# Build System Configuration (PEP 517/518)
# =============================================================================

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

# Alternative build backends:
# - Setuptools: requires = ["setuptools>=64", "wheel"]
#               build-backend = "setuptools.build_meta"
# - Flit: requires = ["flit_core>=3.4"]
#         build-backend = "flit_core.buildapi"
# - Poetry: requires = ["poetry-core"]
#           build-backend = "poetry.core.masonry.api"
# - PDM: requires = ["pdm-backend"]
#        build-backend = "pdm.backend"

# =============================================================================
# Project Metadata (PEP 621)
# =============================================================================

[project]
name = "my-package"  # Package name (PyPI name, use kebab-case or underscores)
version = "0.1.0"    # Semantic versioning: MAJOR.MINOR.PATCH
description = "A brief one-line description of the package"
readme = "README.md"  # Long description from README
requires-python = ">=3.12"  # Minimum Python version required
license = {text = "MIT"}  # or {file = "LICENSE"}
keywords = ["example", "template", "python"]
authors = [
    {name = "Your Name", email = "you@example.com"},
]
maintainers = [
    {name = "Maintainer Name", email = "maintainer@example.com"},
]
classifiers = [
    # PyPI classifiers: https://pypi.org/classifiers/
    "Development Status :: 3 - Alpha",
    "Intended Audience :: Developers",
    "License :: OSI Approved :: MIT License",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.12",
    "Programming Language :: Python :: 3.13",
    "Topic :: Software Development :: Libraries :: Python Modules",
]

# Runtime dependencies
dependencies = [
    "requests>=2.31.0",
    "pydantic>=2.5.0",
    "httpx>=0.25.0",
]

# Optional dependencies (extras)
[project.optional-dependencies]
# Development dependencies
dev = [
    "pytest>=7.4.0",
    "pytest-cov>=4.1.0",
    "pytest-mock>=3.12.0",
    "pytest-asyncio>=0.21.0",
    "ruff>=0.1.6",
    "mypy>=1.7.0",
    "bandit>=1.7.5",
    "pre-commit>=3.5.0",
]

# Documentation dependencies
docs = [
    "sphinx>=7.2.0",
    "sphinx-rtd-theme>=2.0.0",
    "myst-parser>=2.0.0",
]

# Testing dependencies (separate from dev)
test = [
    "pytest>=7.4.0",
    "pytest-cov>=4.1.0",
    "pytest-mock>=3.12.0",
]

# All extras combined
all = [
    "my-package[dev,docs,test]",
]

# URLs for project links
[project.urls]
Homepage = "https://github.com/username/my-package"
Documentation = "https://my-package.readthedocs.io"
Repository = "https://github.com/username/my-package"
Issues = "https://github.com/username/my-package/issues"
Changelog = "https://github.com/username/my-package/blob/main/CHANGELOG.md"

# Console scripts (CLI entry points)
[project.scripts]
my-cli = "my_package.cli:main"
# Add more CLI commands here:
# my-tool = "my_package.tools:run"

# GUI scripts (on Windows, creates .pyw instead of .py)
# [project.gui-scripts]
# my-gui = "my_package.gui:main"

# =============================================================================
# Tool Configurations
# =============================================================================

# -----------------------------------------------------------------------------
# Ruff - Modern Python Linter and Formatter
# https://docs.astral.sh/ruff/
# -----------------------------------------------------------------------------

[tool.ruff]
# Exclude common directories
exclude = [
    ".git",
    ".mypy_cache",
    ".pytest_cache",
    ".ruff_cache",
    ".venv",
    "venv",
    "__pycache__",
    "build",
    "dist",
]

# Line length (88 for Black compatibility, 100 for more space)
line-length = 100

# Target Python version
target-version = "py312"

# Ruff Linter Configuration
[tool.ruff.lint]
# Select rules to enable
# See: https://docs.astral.sh/ruff/rules/
select = [
    "E",     # pycodestyle errors
    "F",     # pyflakes
    "I",     # isort (import sorting)
    "N",     # pep8-naming
    "W",     # pycodestyle warnings
    "UP",    # pyupgrade
    "B",     # flake8-bugbear
    "C4",    # flake8-comprehensions
    "SIM",   # flake8-simplify
    "TCH",   # flake8-type-checking
    "RUF",   # Ruff-specific rules
]

# Rules to ignore
ignore = [
    "E501",  # Line too long (handled by formatter)
]

# Allow fix for all enabled rules (when `--fix` is used)
fixable = ["ALL"]
unfixable = []

# Allow unused variables when prefixed with underscore
dummy-variable-rgx = "^(_+|(_+[a-zA-Z0-9_]*[a-zA-Z0-9]+?))$"

# Per-file ignores
[tool.ruff.lint.per-file-ignores]
"__init__.py" = ["F401"]  # Unused imports in __init__.py
"tests/**/*.py" = [
    "S101",  # Use of assert
    "ARG",   # Unused function arguments (fixtures)
    "FBT",   # Boolean trap
]

# Ruff Formatter Configuration
[tool.ruff.format]
# Quote style (consistent with Black)
quote-style = "double"

# Indentation style
indent-style = "space"

# Respect magic trailing comma
skip-magic-trailing-comma = false

# Line ending style
line-ending = "auto"

# -----------------------------------------------------------------------------
# mypy - Static Type Checker
# https://mypy.readthedocs.io/
# -----------------------------------------------------------------------------

[tool.mypy]
# Python version to target
python_version = "3.12"

# Strict mode (recommended for new projects)
strict = true

# Additional strict checks
warn_return_any = true
warn_unused_configs = true
warn_redundant_casts = true
warn_unused_ignores = true
warn_no_return = true
warn_unreachable = true

# Disallow untyped definitions
disallow_untyped_defs = true
disallow_incomplete_defs = true
disallow_untyped_calls = true

# Disallow Any usage
disallow_any_unimported = false
disallow_any_expr = false
disallow_any_decorated = false
disallow_any_explicit = false
disallow_any_generics = true
disallow_subclassing_any = true

# Miscellaneous strictness flags
no_implicit_optional = true
strict_equality = true
strict_concatenate = true

# Per-module overrides (for third-party libraries without type stubs)
[[tool.mypy.overrides]]
module = [
    "untyped_library.*",
]
ignore_missing_imports = true

# -----------------------------------------------------------------------------
# pytest - Testing Framework
# https://docs.pytest.org/
# -----------------------------------------------------------------------------

[tool.pytest.ini_options]
# Test discovery
testpaths = ["tests"]
python_files = ["test_*.py", "*_test.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]

# pytest output options
addopts = [
    "-ra",                    # Show summary of all test outcomes
    "--strict-markers",       # Treat unregistered markers as errors
    "--strict-config",        # Treat config errors as errors
    "-v",                     # Verbose output
    "--cov=src",              # Coverage for src/ directory
    "--cov-report=html",      # HTML coverage report
    "--cov-report=term-missing",  # Terminal report showing missing lines
]

# Markers for test categorization
markers = [
    "slow: marks tests as slow (deselect with '-m \"not slow\"')",
    "integration: marks tests as integration tests",
    "unit: marks tests as unit tests",
]

# Asyncio configuration
asyncio_mode = "auto"

# -----------------------------------------------------------------------------
# Coverage - Code Coverage Measurement
# https://coverage.readthedocs.io/
# -----------------------------------------------------------------------------

[tool.coverage.run]
source = ["src"]
branch = true
parallel = true
omit = [
    "tests/*",
    "*/migrations/*",
    "*/__init__.py",
]

[tool.coverage.report]
precision = 2
show_missing = true
skip_covered = false
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "if TYPE_CHECKING:",
    "raise AssertionError",
    "raise NotImplementedError",
    "if __name__ == .__main__.:",
    "@abstractmethod",
    "@abc.abstractmethod",
]

[tool.coverage.html]
directory = "htmlcov"

# -----------------------------------------------------------------------------
# Bandit - Security Linter
# https://bandit.readthedocs.io/
# -----------------------------------------------------------------------------

[tool.bandit]
exclude_dirs = ["tests", ".venv", "venv"]
skips = [
    "B101",  # Use of assert (acceptable in tests)
]

# -----------------------------------------------------------------------------
# Black - Code Formatter (if not using Ruff format)
# https://black.readthedocs.io/
# -----------------------------------------------------------------------------

# [tool.black]
# line-length = 88
# target-version = ["py312"]
# include = '\.pyi?$'
# exclude = '''
# /(
#     \.git
#   | \.mypy_cache
#   | \.pytest_cache
#   | \.ruff_cache
#   | \.venv
#   | venv
#   | build
#   | dist
# )/
# '''

# -----------------------------------------------------------------------------
# isort - Import Sorting (if not using Ruff)
# https://pycqa.github.io/isort/
# -----------------------------------------------------------------------------

# [tool.isort]
# profile = "black"
# line_length = 88
# multi_line_output = 3
# include_trailing_comma = true
# force_grid_wrap = 0
# use_parentheses = true
# ensure_newline_before_comments = true

# =============================================================================
# Hatchling Build Configuration (optional)
# =============================================================================

[tool.hatch.build.targets.wheel]
packages = ["src/my_package"]

# Include additional files
[tool.hatch.build.targets.sdist]
include = [
    "/src",
    "/tests",
    "/README.md",
    "/LICENSE",
    "/pyproject.toml",
]

# =============================================================================
# Notes
# =============================================================================

# This template uses:
# - Hatchling as build backend (modern, simple, official PyPA project)
# - PEP 621 project metadata
# - Ruff for linting and formatting (all-in-one, fastest)
# - mypy for type checking (strict mode)
# - pytest for testing
# - Bandit for security linting
#
# To use this template:
# 1. Replace "my-package" and "my_package" with your package name
# 2. Update metadata (authors, description, URLs)
# 3. Adjust dependencies
# 4. Configure tool options as needed
# 5. Run: uv sync (or pip install -e ".[dev]")
#
# References:
# - PEP 517: https://peps.python.org/pep-0517/
# - PEP 518: https://peps.python.org/pep-0518/
# - PEP 621: https://peps.python.org/pep-0621/
# - Python Packaging: https://packaging.python.org/
